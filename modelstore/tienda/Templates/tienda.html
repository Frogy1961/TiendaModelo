{% extends "website/Base.html" %}
{% load static %}

{% block content %}

<!-- AOS CSS -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">

<style>
  /* Estilos de productos */
  .product-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: none;
    border-radius: 8px;
    overflow: hidden;
    background-color: #fff;
  }
  .product-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.15);
  }
  .product-card img {
    height: 250px;
    object-fit: cover;
  }
  .product-card .card-body {
    padding: 15px;
  }
  .product-card .card-title {
    font-weight: bold;
    font-size: 1.2rem;
  }
  .product-card .card-text {
    font-size: 0.95rem;
    color: #555;
  }
  .product-price {
    font-size: 1rem;
    font-weight: 500;
  }
  .product-offer {
    font-size: 1rem;
    font-weight: bold;
    color: red;
  }

  /* Barra de categorías */
  .nav-pills .nav-link {
    border-radius: 50px;
    padding: 6px 14px;
    font-weight: 500;
    color: #0dcaf0;
    border: 1px solid #0dcaf0;
    margin: 0 5px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .nav-pills .nav-link img {
    width: 28px;
    height: 28px;
    object-fit: cover;
    border-radius: 50%;
  }
  .nav-pills .nav-link.active,
  .nav-pills .nav-link:hover {
    background-color: #0dcaf0;
    color: white;
  }
</style>

<div class="container py-5">

  <!-- Título -->
  <h2 class="text-center fw-bold mb-4" data-aos="fade-up">Nuestra Tienda</h2>

  <!-- Barra de categorías -->
  <nav class="mb-5" data-aos="fade-up" data-aos-delay="100">
    <ul class="nav nav-pills justify-content-center flex-wrap">
      <li class="nav-item">
        <a class="nav-link {% if not categoria_activa %}active{% endif %}" href="{% url 'tienda' %}">
          <img src="{% static 'website/img/placeholder.jpg' %}" alt="Todos">
          Todos
        </a>
      </li>
      {% for cat in categorias %}
      <li class="nav-item">
        <a class="nav-link {% if categoria_activa == cat.id %}active{% endif %}" href="{% url 'tienda_categoria' cat.id %}">
          {% if cat.imagen %}
            <img src="{{ cat.imagen.url }}" alt="{{ cat.nombre }}">
          {% else %}
            <img src="{% static 'website/img/placeholder.jpg' %}" alt="Sin imagen">
          {% endif %}
          {{ cat.nombre }}
        </a>
      </li>
      {% endfor %}
    </ul>
  </nav>

  <div class="row">

    <!-- Columna izquierda: Productos -->
    <div class="col-lg-8">
      <div class="row g-4">
        {% for producto in productos %}
          <div class="col-md-6" data-aos="fade-up" data-aos-delay="{{ forloop.counter0|add:1 }}00">
            <div class="card product-card h-100 shadow-sm">

              <a href="#">
                {% if producto.imagen %}
                  <img src="{{ producto.imagen.url }}" class="card-img-top" alt="{{ producto.nombre }}">
                {% else %}
                  <img src="{% static 'website/img/placeholder.jpg' %}" class="card-img-top" alt="sin imagen disponible">
                {% endif %}
              </a>

              <div class="card-body">
                <h5 class="card-title">{{ producto.nombre }}</h5>
                <p class="card-text">{{ producto.descripcion|truncatewords:12 }}</p>
              </div>

              <ul class="list-group list-group-flush">
                <li class="list-group-item product-price">Precio: ${{ producto.precio }}</li>
                {% if producto.precio_oferta > 0 %}
                  <li class="list-group-item product-offer">Oferta: ${{ producto.precio_oferta }}</li>
                {% else %}
                  <li class="list-group-item">Precio Regular</li>
                {% endif %}
              </ul>

              <div class="card-body text-center">
                <a href="{% url 'carro:agregar' producto.id %}" class="btn btn-primary btn-sm">Añadir al carro</a>
              </div>

            </div>
          </div>
        {% empty %}
          <p class="text-center">No hay productos en esta categoría.</p>
        {% endfor %}
      </div>
    </div>

    <!-- Columna derecha: Carrito -->
    <div class="col-lg-4" data-aos="fade-left" data-aos-delay="200">
      {% if request.user.is_authenticated %}
        {% include "carro/widget.html" %}
      {% else %}
        <div class="alert alert-warning">Inicia sesión para comprar</div>
      {% endif %}
    </div>

  </div>
</div>

<!-- AOS JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
<script>
  AOS.init({
    duration: 1000,
    once: true
  });
</script>

{% endblock content %}
